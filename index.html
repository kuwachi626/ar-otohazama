<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="icon" href="data:">
  <title>AR Otohazama</title>
  </head>
  <body>
  
  <header>
    <h1>AR Otohazama</h1>
    LIB: <a href=https://github.com/code4fukui/ar-globe/>AR Globe</a>, <a href="https://github.com/code4fukui/egxr.js/">egxr.js</a><br>
    APP: <a href="https://github.com/code4fukui/ar-earthquakes/">src on GitHub</a><br>
  </header>
  
  <script type="importmap">
  {
    "imports": {
      "three": "https://code4fukui.github.io/three.js/build/three.module.js",
      "three/addons/": "https://code4fukui.github.io/three.js/examples/jsm/"
    }
  }
  </script>
  
  <script type="module">
  import { THREE, scene, camera, renderer } from "https://code4fukui.github.io/egxr.js/egxr.js";
  import { rnd } from "https://js.sabae.cc/rnd.js";
  import { FontLoader } from 'three/addons/loaders/FontLoader.js';
  import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';
  import { createTextMesh } from "./createTextMesh.js";
  import { XRControllerModelFactory } from "https://code4fukui.github.io/three.js/examples/jsm/webxr/XRControllerModelFactory.js";

  export const createSphere = (str, size, color) => {
    const g = new THREE.Group();
    const geo = new THREE.SphereGeometry(size, 15, 32);
    const mat = new THREE.MeshBasicMaterial({ color, opacity: 0.6, transparent: true });
    const mesh = new THREE.Mesh(geo, mat);
    g.add(mesh);
    const txt = createTextMesh(str, 0, 0, 0, 0xffffff);
    g.add(txt);
    return g;
  };

  const controllerModelFactory = new XRControllerModelFactory();

  function addController(index) {
  // コントローラの追加
  const controller = renderer.xr.getController(index);
  scene.add(controller);

  // コントローラモデルの追加
  const controllerGrip = renderer.xr.getControllerGrip(index);
  controllerGrip.add(
    controllerModelFactory.createControllerModel(controllerGrip)
  );
  scene.add(controllerGrip);

  }

  // コントローラの準備
  const controller0 = addController(0);
  const controller1 = addController(1);
  
  const music = new Audio("./sound/title.mp3");
  let flg = false;
  
  const textobj = new THREE.Group();
  
  const fontLoader = new FontLoader()
    fontLoader.load("./Reggae One_Regular.json", (font) => {
    const textGeometry1 = new TextGeometry("Δ Δ", {
      font: font,
      size: 0.5,
      height: 0.2,
      curveSegments: 12,
      bevelEnabled: true,
      bevelThickness: 0.03,
      bevelSize: 0.02,
      bevelOffset: 0,
      bevelSegments: 5,
    })
  
    const textGeometry2 = new TextGeometry("(OtO)。HAZAMA", {
      font: font,
      size: 0.5,
      height: 0.2,
      curveSegments: 12,
      bevelEnabled: true,
      bevelThickness: 0.03,
      bevelSize: 0.02,
      bevelOffset: 0,
      bevelSegments: 5,
    })
  
    const textGeometry3 = new TextGeometry("＾＾", {
      font: font,
      size: 0.5,
      height: 0.2,
      curveSegments: 12,
      bevelEnabled: true,
      bevelThickness: 0.03,
      bevelSize: 0.02,
      bevelOffset: 0,
      bevelSegments: 5,
    })
  
    const textMaterial = new THREE.MeshLambertMaterial( { color: 0x00ff00 } )
  
    // Δ Δ
    const text1 = new THREE.Mesh(textGeometry1, textMaterial)
    text1.position.x = -2.7
    text1.position.y = 1.3
    text1.position.z = -20
    
    // (OtO)。HAZAMA
    const text2 = new THREE.Mesh(textGeometry2, textMaterial)
    text2.position.x = -3
    text2.position.y = 0.5
    text2.position.z = -20
  
    // ＾＾
    const text3 = new THREE.Mesh(textGeometry3, textMaterial)
    text3.position.x = -2.7
    text3.position.y = -0.4
    text3.position.z = -20
  
    textobj.add(text1)
    textobj.add(text2)
    textobj.add(text3)
  })
  scene.add(textobj)

  const staposi = new THREE.Vector3(0, -0.3, -0.5);
  const start = createSphere("S", 0.1, 0x00ffff);
  start.position.copy(staposi);
  const starttxt = createTextMesh("START", 0, -0.1, -0.5);
  
  const grp = new THREE.Group();
  
  const list = [];
  for (let i = 0; i < 20; i++) {
    const geometry = new THREE.BoxGeometry(.5, .1, 1);
    const color = rnd(0x1000000);
    const material = new THREE.MeshBasicMaterial({ color }); 
    const cube = new THREE.Mesh(geometry, material);
    const note = rnd(12);
    cube.position.x = (note - 6) * .5;
    cube.position.y = -0.5;
    cube.position.z = -i;
    grp.add(cube);
  }
  scene.add(grp);
  
  const clock = new THREE.Clock();
  renderer.setAnimationLoop(() => {
    grp.position.z += .01;
    // console.log(grp.position.z)
    if (grp.position.z > 20) {
      grp.position.z = -19;
    }
    if (textobj.position.z < 15) {
      textobj.position.z += .01;
      // console.log(textobj.position.z)
    }
    if (textobj.position.z > 15 & flg === false) {
      flg = true
      music.play("title");
      scene.add(start)
      scene.add(starttxt)
    }
    renderer.render(scene, camera);
  });
  
  </script>
  </body>
  </html>
  